# export CC="/usr/local/bin/ccache gcc"
# export CXX="/usr/local/bin/ccache g++"

if is_windows
then
	exit 1
fi

# distcc won't distribute compilation with -march=native, so figure out
# what -march=native means
ARCH=$(gcc -march=native -E -dM -x c++ /dev/null | grep "define __tune" | grep -v "__tune_core_avx2__" | sed 's/^#define __tune_\(.*\)__ 1$/\1/')
ARCHOPTS=
if [ "$ARCH" = "haswell" ]
then
	# Work around bug 680547 / bug 1111355, for which we really only
	# need to change the compilation options for
	# xptcinvoke_x86_64_unix.cpp (if only the pragmas were supported
	# on x86_64 like i386).
	ARCH="corei7"
fi
if [ -n "$ARCH" ]
then
    ARCHOPTS="-march=$ARCH -mtune=$ARCH"
fi

if [ "$(uname -sm)" = "Linux i686" ]
then
	ac_add_options --enable-optimize="-Os -fno-omit-frame-pointer $ARCHOPTS"
else
	ac_add_options --enable-optimize="-Os $ARCHOPTS"
fi
ac_add_options --enable-debug

if_enable_trace_malloc
if_enable_jprof
if_enable_callgrind
if_enable_shark
if_enable_valgrind
