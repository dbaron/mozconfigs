# export CC="/usr/local/bin/ccache gcc"
# export CXX="/usr/local/bin/ccache g++"

# -pedantic-errors -Wno-long-long
# -W -Wno-unused-parameter
# (CFLAGS only) -Wmissing-prototypes -Wmissing-declarations
# export needed for NSPR configure
if ! is_windows
then
	export CFLAGS="$CFLAGS -Wshadow -Wwrite-strings -fmessage-length=0"
	export CXXFLAGS="$CXXFLAGS -Wshadow -fno-nonansi-builtins -Wwrite-strings -fmessage-length=0 -Wno-invalid-offsetof"
	if [ "$(uname -s)" != "Darwin" ]
	then
		# On Mac, -fuse-cxa-atexit causes linker errors
		# (undefined symbols: ___dso_handle)
		export CXXFLAGS="$CXXFLAGS -fuse-cxa-atexit"
	fi
fi

if is_windows
then
	exit 1
fi

# distcc won't distribute compilation with -march=native, so figure out
# what -march=native means
ARCH=$(gcc -march=native -E -dM -x c++ /dev/null | grep "define __tune" | sed 's/^#define __tune_\(.*\)__ 1$/\1/')
ARCHOPTS=
if [ -n "$ARCH" ]
then
    ARCHOPTS="-march=$ARCH -mtune=$ARCH"
fi

if [ "$(uname -sm)" = "Linux i686" ]
then
	ac_add_options --enable-optimize="-O2 -fno-omit-frame-pointer $ARCHOPTS"
else
	ac_add_options --enable-optimize="-O2 $ARCHOPTS"
fi
ac_add_options --enable-debug

if_enable_trace_malloc
if_enable_jprof
